# 🚀 WRDS风格查询系统 - 快速启动指南

## 🚀 快速启动

### 方法1：使用批处理文件（推荐）

1. **启动后端服务**
   - 双击 `start_backend.bat`
   - 等待看到 "Uvicorn running on http://127.0.0.1:8000" 消息

2. **启动前端服务**
   - 双击 `start_frontend.bat`
   - 等待看到 "Local: http://localhost:5173/" 消息

3. **测试系统**
   - 双击 `test_system.py` 或在命令行运行 `python test_system.py`

### 方法2：手动启动

#### 启动后端
```bash
cd backend
venv\Scripts\activate
python main.py
```

#### 启动前端
```bash
cd frontend/vite-project
npm install
npm run dev
```

## 🌐 访问地址

- **前端应用**: http://localhost:5173
- **后端API文档**: http://localhost:8000/docs
- **后端健康检查**: http://localhost:8000/api/health

## 🔧 系统测试

运行测试脚本检查系统状态：
```bash
python test_system.py
```

## 📋 功能说明

### WRDS风格查询系统包含5个步骤：

1. **年份选择** - 选择要查询的数据年度
2. **范围筛选** - 地理位置、财务规模、运营规模筛选
3. **精确定位** - 选择具体的目标组织
4. **变量选择** - 选择需要的数据字段（164个字段）
5. **数据导出** - 导出为Excel、CSV或JSON格式

## 🛠️ 故障排除

### 如果服务启动失败：

1. **检查端口占用**
   - 8000端口：后端服务
   - 5173端口：前端服务

2. **检查依赖**
   - 后端：确保虚拟环境已激活
   - 前端：确保Node.js已安装

3. **查看错误信息**
   - 批处理文件会显示详细的错误信息
   - 检查控制台输出的错误日志

### 常见问题：

**Q: 前端显示空白页面？**
A: 检查后端是否正常运行，确保API连接正常

**Q: 后端启动失败？**
A: 检查Python版本和依赖包是否正确安装

**Q: 端口被占用？**
A: 使用 `netstat -ano | findstr :8000` 检查端口占用情况

## 📞 技术支持

如果遇到问题，请：
1. 运行 `test_system.py` 检查系统状态
2. 查看控制台错误信息
3. 检查网络连接和防火墙设置

## 🎯 使用流程

### Step 1: 选择年份
1. 从下拉菜单选择数据年份
2. 点击"下一步：范围筛选"

### Step 2: 范围筛选
1. **地理位置**：选择州和城市
2. **财务规模**：设置收入和资产范围
3. **运营规模**：设置ILU/ALU最小值
4. 点击"执行筛选"

### Step 3: 精确定位
1. 选择"全部选择"或"精确选择"
2. 如果精确选择，输入组织名称或EIN
3. 查看筛选结果预览
4. 点击"确认选择"

### Step 4: 变量选择
1. 按类别选择需要的字段：
   - 基本信息
   - 财务数据
   - 薪酬数据
   - 资产负债
   - 运营数据
2. 可以按类别全选或单独选择
3. 点击"查询数据"

### Step 5: 导出数据
1. 选择输出格式（XLSX/CSV/JSON）
2. 预览查询结果
3. 点击"导出数据"下载文件

## 🔍 API 测试

可以直接测试后端API：

```bash
# 获取可用年份
curl http://localhost:8000/api/available-years

# 获取可用州
curl http://localhost:8000/api/available-states

# 查看API文档
open http://localhost:8000/docs
```

## 📊 示例查询

### 查询加州的大型养老机构
1. 年份：选择 "12/2023"
2. 范围筛选：
   - 州：CA
   - 总收入：> $10,000,000
   - ILU：> 100
3. 组织选择：全部选择
4. 变量选择：基本信息 + 财务数据 + 运营数据

### 查询特定组织的薪酬信息
1. 年份：选择目标年份
2. 范围筛选：可跳过
3. 组织选择：精确选择，输入EIN号码
4. 变量选择：基本信息 + 薪酬数据

## ⚠️ 注意事项

1. **服务启动顺序**：先启动后端，再启动前端
2. **端口冲突**：确保8000和5173端口未被占用
3. **数据库**：确保 `backend/irs.db` 文件存在
4. **虚拟环境**：建议使用虚拟环境避免依赖冲突

## 🐛 故障排除

### 后端服务无法启动
```bash
# 检查依赖是否安装
pip list | grep fastapi

# 重新安装依赖
pip install -r requirements.txt

# 检查数据库
ls -la irs.db
```

### 前端服务无法启动
```bash
# 清除缓存重新安装
rm -rf node_modules package-lock.json
npm install
```

### API连接失败
1. 确认后端在8000端口运行
2. 检查CORS设置
3. 查看浏览器控制台错误

## 📈 数据统计

当前系统包含：
- **201个非营利组织**
- **164个数据字段**
- **33个州的数据**
- **172个城市**
- **2022-2024年度数据**

## 🎯 核心功能

✅ **类WRDS查询体验**  
✅ **5步分层筛选**  
✅ **164字段完整覆盖**  
✅ **多格式数据导出**  
✅ **实时数据预览**  
✅ **智能字段分类**  

---

**🎉 您的专业级非营利组织数据查询系统已就绪！**